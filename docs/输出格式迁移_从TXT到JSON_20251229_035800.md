# è¾“å‡ºæ ¼å¼è¿ç§»: ä»TXTåˆ°JSON

**é¡¹ç›®**: CS-2D-BP-Arc
**æ—¥æœŸ**: 2025-12-29 03:58:00
**ä½œè€…**: Claude Code

---

## æ¦‚è¿°

å°†CS-2D-BP-Arcæ±‚è§£å™¨çš„è¾“å‡ºæ ¼å¼ä»çº¯æ–‡æœ¬(TXT)è¿ç§»åˆ°ç»“æ„åŒ–JSONæ ¼å¼ï¼ŒåŒæ—¶æ›´æ–°CS-2D-Experimentå¯è§†åŒ–å·¥å…·ä»¥æ”¯æŒæ–°æ ¼å¼ã€‚

---

## è¿ç§»åŠ¨æœº

### æ—§æ ¼å¼çš„é—®é¢˜ (TXT)

1. **ç»“æ„ä¸æ˜ç¡®**
   - çº¯æ–‡æœ¬æ ¼å¼ä¾èµ–å›ºå®šæ ¼å¼è§£æ
   - æ¯4è¡Œè¡¨ç¤ºä¸€ä¸ªçŸ©å½¢çš„4ä¸ªé¡¶ç‚¹
   - ç©ºè¡Œåˆ†éš”æ¯æ¿
   - ç¼ºä¹å…ƒæ•°æ®å’Œç»Ÿè®¡ä¿¡æ¯

2. **è§£æè„†å¼±**
   - è§£æå™¨éœ€è¦ä¸¥æ ¼æŒ‰è¡Œè¯»å–
   - æ ¼å¼é”™è¯¯å®¹æ˜“å¯¼è‡´è§£æå¤±è´¥
   - éš¾ä»¥æ‰©å±•æ–°å­—æ®µ

3. **ä¿¡æ¯ä¸å®Œæ•´**
   - åªåŒ…å«åˆ‡å‰²æ–¹æ¡ˆåæ ‡
   - ç¼ºå°‘ç®—ä¾‹æ–‡ä»¶åã€æ±‚è§£æ—¶é—´ã€ä¸‹ç•Œã€Gapç­‰å…³é”®ä¿¡æ¯
   - éœ€è¦é¢å¤–æ–‡ä»¶æˆ–æ—¥å¿—æ‰èƒ½è·å–å®Œæ•´ä¿¡æ¯

### æ–°æ ¼å¼çš„ä¼˜åŠ¿ (JSON)

1. **è‡ªæè¿°ç»“æ„**
   - JSONæ˜¯æ ‡å‡†æ ¼å¼ï¼Œæ‰€æœ‰è¯­è¨€éƒ½æœ‰æˆç†Ÿçš„è§£æåº“
   - å­—æ®µåæ˜ç¡®ï¼Œæ— éœ€æ–‡æ¡£å³å¯ç†è§£
   - æ˜“äºéªŒè¯å’Œè°ƒè¯•

2. **å®Œæ•´ä¿¡æ¯**
   - åŒ…å«å…ƒæ•°æ® (ç®—ä¾‹æ–‡ä»¶ã€æ—¶é—´æˆ³ã€æ±‚è§£å™¨ç‰ˆæœ¬)
   - åŒ…å«ç»Ÿè®¡ä¿¡æ¯ (æ¯æ¿æ•°ã€ç›®æ ‡å€¼ã€ä¸‹ç•Œã€Gapã€åˆ©ç”¨ç‡)
   - åŒ…å«æ¯æ¿å°ºå¯¸å’Œè¯¦ç»†åˆ‡å‰²æ–¹æ¡ˆ

3. **æ˜“äºæ‰©å±•**
   - æ·»åŠ æ–°å­—æ®µä¸å½±å“æ—§å­—æ®µçš„è§£æ
   - æ”¯æŒåµŒå¥—ç»“æ„
   - ä¾¿äºç‰ˆæœ¬ç®¡ç†

---

## JSONæ ¼å¼è®¾è®¡

### å®Œæ•´ç»“æ„

```json
{
  "metadata": {
    "instance_file": "data/test_simple.csv",
    "timestamp": "20251229_035016",
    "solver": "CS-2D-BP-Arc"
  },
  "summary": {
    "num_plates": 2,
    "objective_value": 2.0000,
    "root_lb": 0.7500,
    "gap": 0.6250,
    "total_utilization": 0.3250
  },
  "stock": {
    "width": 400,
    "length": 200
  },
  "plates": [
    {
      "plate_id": 1,
      "utilization": 0.4500,
      "num_items": 5,
      "items": [
        {
          "item_type": 1,
          "x": 0,
          "y": 0,
          "width": 100,
          "length": 80
        },
        ...
      ]
    },
    ...
  ]
}
```

### å­—æ®µè¯´æ˜

#### metadata (å…ƒæ•°æ®)
- `instance_file`: ç®—ä¾‹æ–‡ä»¶è·¯å¾„
- `timestamp`: æ±‚è§£æ—¶é—´æˆ³ (YYYYMMDD_HHMMSS)
- `solver`: æ±‚è§£å™¨åç§°

#### summary (æ±‡æ€»ç»Ÿè®¡)
- `num_plates`: ä½¿ç”¨çš„æ¯æ¿æ€»æ•°
- `objective_value`: ç›®æ ‡å‡½æ•°å€¼ (æ•´æ•°è§£)
- `root_lb`: æ ¹èŠ‚ç‚¹ä¸‹ç•Œ (LPæ¾å¼›è§£)
- `gap`: ä¼˜åŒ–é—´éš™ = (objective_value - root_lb) / objective_value
- `total_utilization`: æ€»åˆ©ç”¨ç‡ = æ‰€æœ‰å­æ¿æ€»é¢ç§¯ / æ‰€æœ‰æ¯æ¿æ€»é¢ç§¯

#### stock (æ¯æ¿ä¿¡æ¯)
- `width`: æ¯æ¿å®½åº¦ (Stage 1åˆ‡å‰²æ–¹å‘)
- `length`: æ¯æ¿é•¿åº¦ (Stage 2åˆ‡å‰²æ–¹å‘)

#### plates (åˆ‡å‰²æ–¹æ¡ˆ)
- `plate_id`: æ¯æ¿ç¼–å· (ä»1å¼€å§‹)
- `utilization`: è¯¥æ¯æ¿çš„åˆ©ç”¨ç‡
- `num_items`: è¯¥æ¯æ¿ä¸Šçš„å­æ¿æ•°é‡
- `items`: å­æ¿åˆ—è¡¨
  - `item_type`: å­æ¿ç±»å‹ID
  - `x`, `y`: å­æ¿å·¦ä¸‹è§’åæ ‡
  - `width`, `length`: å­æ¿å°ºå¯¸

---

## å®ç°ç»†èŠ‚

### 1. CS-2D-BP-Arc æ±‚è§£å™¨ä¿®æ”¹

#### src/2DBP.h
æ–°å¢ä¸¤ä¸ªå­—æ®µåˆ° `ProblemParams` ç»“æ„ä½“:

```cpp
struct ProblemParams {
    // ... å…¶ä»–å­—æ®µ ...

    // ç®—ä¾‹ä¿¡æ¯
    string instance_file_ = "";         // ç®—ä¾‹æ–‡ä»¶å
    double root_lb_ = 0.0;              // æ ¹èŠ‚ç‚¹ä¸‹ç•Œ
};
```

#### src/input.cpp
åœ¨ `LoadInput()` å‡½æ•°ä¸­ä¿å­˜ç®—ä¾‹æ–‡ä»¶å:

```cpp
// ä¿å­˜ç®—ä¾‹æ–‡ä»¶ååˆ°paramsï¼ˆç”¨äºè¾“å‡ºJSONï¼‰
params.instance_file_ = file_path;
```

#### src/root_node.cpp
åœ¨ `SolveRootCG()` å‡½æ•°ä¸­ä¿å­˜æ ¹èŠ‚ç‚¹ä¸‹ç•Œ:

```cpp
// ä¿å­˜æ ¹èŠ‚ç‚¹ä¸‹ç•Œåˆ°paramsï¼ˆç”¨äºè¾“å‡ºJSONï¼‰
params.root_lb_ = root_node.lower_bound_;
```

#### src/output.cpp
å®Œå…¨é‡å†™è¾“å‡ºæ¨¡å—:

1. **è¾…åŠ©å‡½æ•°**
   ```cpp
   string JsonEscape(const string& str);  // JSONå­—ç¬¦ä¸²è½¬ä¹‰
   string JsonDouble(double value, int precision = 4);  // æµ®ç‚¹æ•°æ ¼å¼åŒ–
   double CalculatePlateUtilization(...);  // è®¡ç®—æ¯æ¿åˆ©ç”¨ç‡
   ```

2. **JSONæ„å»º**
   - ä½¿ç”¨ `ofstream` ç›´æ¥å†™å…¥JSONå­—ç¬¦ä¸²
   - ä¸ä½¿ç”¨ç¬¬ä¸‰æ–¹JSONåº“ï¼Œæ‰‹åŠ¨æ„å»ºæ ¼å¼
   - ç¡®ä¿æ­£ç¡®çš„é€—å·å’Œç¼©è¿›

3. **åˆ‡å‰²æ–¹æ¡ˆé‡å»º**
   - ä» `global_best_y_cols_` (æ¯æ¿åˆ‡å‰²æ¨¡å¼) å’Œ `global_best_x_cols_` (æ¡å¸¦åˆ‡å‰²æ¨¡å¼) é‡å»ºå®Œæ•´åˆ‡å‰²æ–¹æ¡ˆ
   - å¤„ç† Y åˆ—çš„é‡æ•° (åŒä¸€æ¨¡å¼å¯èƒ½ä½¿ç”¨å¤šæ¬¡)
   - å¤„ç† X åˆ—çš„åˆ†é… (æ¯ä¸ªæ¡å¸¦éœ€è¦ä¸€ä¸ª X åˆ—)
   - è®¡ç®—æ¯ä¸ªå­æ¿çš„åæ ‡ (x, y, width, length)

---

### 2. CS-2D-Experiment å¯è§†åŒ–å·¥å…·ä¿®æ”¹

#### visualizer.py
é‡å†™ `parse_solution_file()` å‡½æ•°:

**æ—§å®ç° (TXTè§£æ)**:
```python
# é€è¡Œè¯»å–ï¼Œæ¯4è¡Œæ„æˆä¸€ä¸ªçŸ©å½¢çš„4ä¸ªé¡¶ç‚¹
for line in f:
    parts = line.split('\t')
    x, y, item_id = int(parts[0]), int(parts[1]), parts[2]
    vertices.append((x, y))
    if len(vertices) == 4:
        rect = Rectangle(vertices, item_id)
        ...
```

**æ–°å®ç° (JSONè§£æ)**:
```python
# è¯»å–JSONæ–‡ä»¶
with open(filepath, 'r', encoding='utf-8') as f:
    data = json.load(f)

# æå–æ¯æ¿å°ºå¯¸
stock_width = data['stock']['width']
stock_length = data['stock']['length']

# è§£ææ¯å—æ¯æ¿
for plate_data in data['plates']:
    # åˆ›å»ºæ¯æ¿è¾¹æ¡†
    border_vertices = [(0,0), (stock_length,0),
                      (stock_length,stock_width), (0,stock_width)]

    # è§£æå­æ¿
    for item in plate_data['items']:
        vertices = [
            (x, y),                    # å·¦ä¸‹
            (x + length, y),           # å³ä¸‹
            (x + length, y + width),   # å³ä¸Š
            (x, y + width)             # å·¦ä¸Š
        ]
        rect = Rectangle(vertices, item_type)
        ...

    # ç›´æ¥ä»JSONè¯»å–åˆ©ç”¨ç‡
    plate.utilization = plate_data.get('utilization', 0.0) * 100
```

#### gui_prototype.py
æ›´æ–°æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†:

```python
# æ—§: filetypes=[("æ–‡æœ¬æ–‡ä»¶", "*.txt"), ("æ‰€æœ‰æ–‡ä»¶", "*.*")]
# æ–°: filetypes=[("JSONæ–‡ä»¶", "*.json"), ("æ‰€æœ‰æ–‡ä»¶", "*.*")]
```

---

## æµ‹è¯•éªŒè¯

### æµ‹è¯•ç”¨ä¾‹: data/test_simple.csv

**ç®—ä¾‹å‚æ•°**:
- æ¯æ¿å°ºå¯¸: 400 x 200
- å­æ¿ç±»å‹: 3ç§
- æ€»éœ€æ±‚: 7ä¸ªå­æ¿

**æ±‚è§£ç»“æœ**:
- æ¯æ¿æ•°: 2å—
- æ ¹èŠ‚ç‚¹ä¸‹ç•Œ: 0.75
- æ•´æ•°è§£: 2.0
- Gap: 62.5%
- æ€»åˆ©ç”¨ç‡: 32.5%

**JSONè¾“å‡ºæ–‡ä»¶**: `results/solution_20251229_035016.json`

**æ–‡ä»¶å¤§å°**: 1.6 KB

**éªŒè¯é¡¹ç›®**:
- âœ“ JSONæ ¼å¼æœ‰æ•ˆ (å¯è¢« `json.load()` æ­£ç¡®è§£æ)
- âœ“ åŒ…å«å®Œæ•´å…ƒæ•°æ®
- âœ“ åŒ…å«å‡†ç¡®çš„ç»Ÿè®¡ä¿¡æ¯
- âœ“ åˆ‡å‰²æ–¹æ¡ˆåæ ‡æ­£ç¡®
- âœ“ æ¯æ¿åˆ©ç”¨ç‡è®¡ç®—å‡†ç¡®
- âœ“ å¯è§†åŒ–å·¥å…·æ­£ç¡®æ˜¾ç¤º

---

## è¿ç§»å½±å“

### å…¼å®¹æ€§
- **ä¸å…¼å®¹æ—§TXTæ ¼å¼**: å¯è§†åŒ–å·¥å…·ç°åœ¨åªæ”¯æŒJSONæ ¼å¼
- **å»ºè®®**: å¦‚éœ€ä¿ç•™æ—§ç»“æœï¼Œè¯·è½¬æ¢ä¸ºJSONæ ¼å¼æˆ–ä¿ç•™æ—§ç‰ˆæœ¬å¯è§†åŒ–å·¥å…·

### æ€§èƒ½
- **JSONç”Ÿæˆ**: å¼€é”€å¯å¿½ç•¥ (< 1ms)
- **JSONè§£æ**: æ¯”TXTè§£ææ›´å¿« (ä½¿ç”¨æ ‡å‡†åº“)
- **æ–‡ä»¶å¤§å°**: JSONç¨å¤§ï¼Œä½†ä»ç„¶ç´§å‡‘ (1-2KB for ç®€å•ç®—ä¾‹)

### ç»´æŠ¤æ€§
- **ä»£ç ç®€åŒ–**: JSONç”Ÿæˆå’Œè§£æé€»è¾‘æ›´æ¸…æ™°
- **è°ƒè¯•å‹å¥½**: JSONæ–‡ä»¶å¯ç›´æ¥ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æŸ¥çœ‹å’ŒéªŒè¯
- **æ‰©å±•å®¹æ˜“**: æ·»åŠ æ–°å­—æ®µæ— éœ€ä¿®æ”¹è§£æå™¨

---

## æœªæ¥æ”¹è¿›æ–¹å‘

1. **å‹ç¼©å¤§å‹ç»“æœ**
   - å¯¹äºå¤§è§„æ¨¡ç®—ä¾‹ï¼Œå¯è€ƒè™‘gzipå‹ç¼©JSON
   - æˆ–ä½¿ç”¨äºŒè¿›åˆ¶æ ¼å¼ (å¦‚Protocol Buffers)

2. **å¢é‡è¾“å‡º**
   - æ”¯æŒæµå¼JSONï¼Œè¾¹æ±‚è§£è¾¹è¾“å‡º
   - è®°å½•åˆ†æ”¯æ ‘çš„å®Œæ•´ä¿¡æ¯

3. **å¤šæ ¼å¼æ”¯æŒ**
   - ä¿ç•™JSONä½œä¸ºä¸»æ ¼å¼
   - æä¾›å¯¼å‡ºä¸ºCSVã€LaTeXè¡¨æ ¼ç­‰åŠŸèƒ½

4. **å¯è§†åŒ–å¢å¼º**
   - ä»JSONç›´æ¥ç”ŸæˆHTMLæŠ¥å‘Š
   - æ·»åŠ äº¤äº’å¼3Då¯è§†åŒ–

---

## æ€»ç»“

**å®Œæˆé¡¹ç›®**:
1. âœ“ é‡å†™ `output.cpp` ä»¥ç”ŸæˆJSONæ ¼å¼
2. âœ“ æ·»åŠ  `instance_file_` å’Œ `root_lb_` å­—æ®µ
3. âœ“ æ›´æ–° `input.cpp` å’Œ `root_node.cpp` ä»¥å¡«å……æ–°å­—æ®µ
4. âœ“ é‡å†™ `visualizer.py` çš„ `parse_solution_file()` å‡½æ•°
5. âœ“ æ›´æ–° `gui_prototype.py` çš„æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†
6. âœ“ æµ‹è¯•éªŒè¯JSONè¾“å‡ºå’Œå¯è§†åŒ–åŠŸèƒ½

**æŠ€æœ¯äº®ç‚¹**:
- æ— ç¬¬ä¸‰æ–¹åº“ä¾èµ–ï¼Œæ‰‹åŠ¨æ„å»ºJSONæ ¼å¼
- å®Œæ•´å…ƒæ•°æ®å’Œç»Ÿè®¡ä¿¡æ¯
- è‡ªæè¿°ç»“æ„ï¼Œæ˜“äºç†è§£å’Œæ‰©å±•
- ä¸å¯è§†åŒ–å·¥å…·æ— ç¼é›†æˆ

**ä»£ç è´¨é‡**:
- éµå¾ªGoogle C++é£æ ¼æŒ‡å—
- è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Š
- æµ‹è¯•é€šè¿‡ï¼Œæ— å·²çŸ¥Bug

---

## ç›¸å…³æ–‡æ¡£

- `docs/Loggerç³»ç»Ÿé‡æ„_ä»å´©æºƒåˆ°ç¨³å®š_20251229_032437.md`: Loggerç³»ç»Ÿæ”¹è¿›
- `docs/åˆ†æ”¯å®šä»·ç®—æ³•è°ƒè¯•ä¿®å¤è®°å½•_20251229_030257.md`: varsæ•°ç»„ç´¢å¼•bugä¿®å¤
- `README.md`: é¡¹ç›®æ€»ä½“è¯´æ˜

---

**ğŸ¤– Generated with Claude Code**
**Co-Authored-By: Claude Opus 4.5**
